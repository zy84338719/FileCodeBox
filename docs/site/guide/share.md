# 分享与领取

上传完成后，FileCodeBox 会生成一组包含 **访问地址 + 提取码** 的凭据。本章介绍如何管理分享策略以及领取流程。

## 分享凭据

| 项目 | 示例 |
| --- | --- |
| 链接 | `https://your-domain.com/s/abcd1234` |
| 提取码 | `9K8M`（长度可配置） |
| 有效期 | 7 天 / 10 次下载 / 永久 |

用户可以：

- 复制链接与提取码发送给接收方
- 直接从结果面板一键复制 JSON 或 Markdown 片段
- 通过邮件 / IM / Webhook 发送（可二次开发）

## 下载流程

1. 访问分享链接或在首页输入提取码
2. 系统校验有效期 / 下载次数 / 登录状态
3. 通过前端下载器或浏览器内置下载保存文件

> 如果开启“需要登录下载”，未认证用户将被引导至登录界面。

## 高级策略

| 策略 | 配置位置 | 说明 |
| --- | --- | --- |
| 有效期模式 | 后台 → 系统设置 → 分享策略 | 支持分钟、小时、天、次数、永久 |
| 下载次数限制 | 同上 | 超过限制后自动设为过期状态 |
| 强制登录下载 | 后台或 `config.yaml` → `transfer.download.require_login` |
| 自定义提取码长度 | `config.yaml` → `base.share_code_length`（示例） |
| 禁止匿名上传 | `config.yaml` → `transfer.upload.require_login` |

## 分享管理

- **用户中心 → 我的文件**：
  - 查看上传的文件列表、有效期、下载次数
  - 支持复制链接、复制提取码、撤销分享
- **管理后台 → 文件管理**：
  - 支持模糊搜索、标签筛选、批量删除
  - 可查看源 IP、用户、上传时间、过期状态
  - 支持导出 CSV 或触发手动清理

## 分享状态

| 状态 | 含义 |
| --- | --- |
| 正常 | 未超期、未超次，可正常下载 |
| 即将过期 | 接近有效期阈值，可配置告警或提示 |
| 已过期 | 已超过有效期或下载次数，可在后台恢复（若文件仍在存储中） |
| 已撤回 | 用户或管理员手动删除分享记录 |

## 与自动化结合

- **Webhook / MCP（规划中）**：上传成功后通知内网系统或 AI 助手
- **API 集成**：使用 `POST /share/file/`、`POST /share/text/` 等接口主动创建分享
- **CLI**：`./filecodebox share create --file path/to/file --expire "7d"`

下一章节：[管理后台总览](./management.md)
