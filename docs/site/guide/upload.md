# 文件上传体验

FileCodeBox 2025 版围绕“极速上传 + 可控分享”打造了全新的用户体验。本章介绍上传方式、进度可视化以及断点续传机制。

## 上传入口

- **用户中心 Dashboard**：登录后默认位于“上传文件”标签页，支持拖拽与点击选择。
- **匿名上传（可选）**：若在配置中启用匿名上传，未登录用户可通过首页上传并获取分享链接。
- **API / CLI**：通过 REST API 或 CLI 上传文件，可结合 CI/CD 与自动化脚本。

## 支持的上传方式

| 类型 | 说明 |
| --- | --- |
| 单文件上传 | 直接选择单个文件，适用于小体积分享 |
| 批量上传 | 多选文件后统一生成同一份分享记录 |
| 文件夹上传 | 浏览器使用 `webkitdirectory` 选择文件夹，结构将被打包并保留层级 |
| 文本分享 | 在“文本分享”面板粘贴内容，系统会生成纯文本分享记录 |

## 分片 / 秒传 / 断点续传

服务端提供 `chunk` 模块支持大文件上传：

1. `POST /chunk/upload/init/` — 创建上传任务并返回 `upload_id`
2. `POST /chunk/upload/chunk/:upload_id/:index` — 上传指定分片
3. `POST /chunk/upload/complete/:upload_id` — 合并分片并生成文件记录

> 前端会在每个分片前进行 MD5 校验，当检测到文件已存在时走“秒传”路径，显著缩短同文件二次上传的时间。

### 任务状态查询

- `GET /chunk/upload/status/:upload_id`
- `DELETE /chunk/upload/cancel/:upload_id`

这些接口也可用于 CLI 或自动化脚本，以确保在非浏览器环境同样能恢复上传。

## 上传选项

在上传面板中，可以直接配置以下参数：

| 选项 | 说明 |
| --- | --- |
| 过期方式 | 支持按分钟 / 小时 / 天 / 次数 / 永不过期 |
| 过期值 | 与过期方式联动，例如“下载 3 次后自动失效” |
| 需要登录下载 | 勾选后仅认证用户可下载，对内部共享更安全 |
| 自定义提取码 | 管理后台可配置是否开放自定义提取码前缀 |

> 这些默认值可在配置中心（后台 **系统设置 → 分享策略**）调整，并同步给所有用户。

## 上传进度反馈

- **进度条**：显示当前分片进度、已上传大小与百分比
- **状态文案**：明确告诉用户正在上传/秒传/校验/合并
- **结果面板**：展示下载链接、提取码、有效期、复制按钮

管理后台同时会记录上传日志，可在文件列表中查看上传者、IP、耗时等信息。

## 常见问题

| 问题 | 解决方案 |
| --- | --- |
| 上传被中断 | 前端会自动重试；若超出重试次数，可在 Dashboard 中重新选择同一文件，系统将从断点处续传 |
| 大文件耗时太久 | 调整 `transfer.upload.chunk_size` 与 `upload_size`，或迁移到对象存储获得更高带宽 |
| 浏览器不支持文件夹上传 | 建议使用 Chrome / Edge / Safari 新版本，或改用批量上传 |

继续阅读：[分享与领取](./share.md)
