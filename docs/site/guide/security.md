# 安全加固最佳实践

FileCodeBox 默认提供提取码、限次、限期等安全能力。若部署在互联网环境，推荐遵循以下策略。

## 初始化安全

- 首次访问需通过 `/setup` 创建管理员，仅允许本地或白名单 IP 访问该向导
- 初始化完成后 `/setup` 自动禁用
- 管理员密码建议 >= 12 位、包含大小写+数字+符号

## 网络与访问控制

| 建议 | 说明 |
| --- | --- |
| HTTPS | 使用 Nginx/Traefik 等反向代理签发 TLS 证书 |
| 反向代理保护 | 通过 Basic Auth、IP 白名单、GeoIP 规则限制访问 `/admin/` |
| 限流 | 启用 Gin 中间件的速率限制，防止暴力破解或刷接口 |
| CDN 缓存 | 对公共分享可使用 CDN，但需关闭对 `/admin`、API 的缓存 |

## 登录与令牌

- 后台登录使用 JWT，配置 `user.session_expiry_hours` 控制令牌有效期
- 建议开启“管理员二次验证”（通过自定义代码或反向代理），例如接入企业 SSO
- 定期审查 `user_sessions` / `api_keys`，清除不活跃会话

## 分享策略

- 默认开启提取码，长度 4~6 位
- 对敏感文件启用“登录后下载”或使用用户系统分享
- 通过后台配置最大下载次数与有效期，避免永久链接泄露

## 数据与存储安全

| 场景 | 建议 |
| --- | --- |
| 数据库 | 使用强密码、限制访问源 IP、定期备份 SQLite/MySQL/PG 数据 |
| 存储 | 对对象存储设置私有访问策略，结合临时授权 URL（规划中）|
| 本地磁盘 | 配置定期备份、文件系统加密、日志审计 |

## 日志与审计

- 开启管理操作审计，记录管理员所有动作
- 利用 CLI 或 API 周期性导出审计日志
- 结合外部 SIEM / 日志平台建立异常告警

## 安全更新

- 关注仓库 `SECURITY.md`（若存在）与 Release Notes
- 使用 Dependabot / Renovate 监控依赖更新
- 升级前务必在预生产环境验证

## 集成企业安全体系

- 身份认证：可将登录接入自定义 OAuth2 / SSO（需二次开发）
- 零信任：结合自建身份代理或 Cloudflare Access 控制访问入口
- 数据脱敏：对上传流程增加自定义 Hook，检测敏感数据

## 应急预案

1. 发现数据泄露时，立即在后台撤销共享或使用 API 批量失效
2. 重置所有管理员密码与 API Key
3. 调整分享策略，加严提取码或强制登录
4. 通知受影响用户，并根据合规要求上报

更多安全专题可参考 `docs/ADMIN_STATIC_PROTECTION.md`、`docs/ENVIRONMENT_VARIABLES.md`。
