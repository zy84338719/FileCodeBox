<div class="storage-management">
    <!-- 存储管理头部 -->
    <div class="page-header">
        <div class="header-left">
            <h2>存储管理</h2>
            <p>配置和管理文件存储后端，支持本地存储、S3、WebDAV、FTP等</p>
        </div>
        <div class="header-right">
            <button id="refresh-stats-btn" class="btn btn-secondary">
                <i class="icon-refresh"></i> 刷新统计
            </button>
        </div>
    </div>

    <!-- 存储统计 -->
    <div class="stats-section">
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">📁</div>
                <div class="stat-content">
                    <div class="stat-label">总文件数</div>
                    <div class="stat-value" id="total-files">0</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">💾</div>
                <div class="stat-content">
                    <div class="stat-label">总存储大小</div>
                    <div class="stat-value" id="total-size">0 B</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">📊</div>
                <div class="stat-content">
                    <div class="stat-label">已用空间</div>
                    <div class="stat-value" id="used-space">0 B</div>
                </div>
            </div>
            
            <div class="stat-card">
                <div class="stat-icon">🔋</div>
                <div class="stat-content">
                    <div class="stat-label">可用空间</div>
                    <div class="stat-value" id="available-space">无限制</div>
                </div>
            </div>
        </div>
        
        <!-- 存储使用率 -->
        <div class="usage-section">
            <div class="usage-header">
                <h3>存储使用率</h3>
                <span id="storage-usage-percent">0%</span>
            </div>
            <div class="progress-bar-container">
                <div id="storage-usage-bar" class="progress-bar progress-success" style="width: 0%"></div>
            </div>
        </div>
    </div>

    <!-- 存储配置 -->
    <div class="config-section">
        <div class="section-header">
            <h3>存储配置</h3>
            <div class="section-actions">
                <button id="test-connection-btn" class="btn btn-secondary">测试连接</button>
                <button id="save-storage-config-btn" class="btn btn-primary">保存配置</button>
            </div>
        </div>
        
        <div class="config-form">
            <!-- 存储类型选择 -->
            <div class="form-group">
                <label for="storage-type">存储类型</label>
                <select id="storage-type" class="form-select">
                    <option value="local">本地存储</option>
                    <option value="s3">S3 兼容存储</option>
                    <option value="webdav">WebDAV 存储</option>
                    <option value="ftp">FTP 存储</option>
                </select>
                <div id="storage-help" class="field-help">
                    本地存储：文件保存在服务器本地磁盘，简单可靠但不支持分布式部署。
                </div>
            </div>

            <!-- 本地存储配置 -->
            <div id="local-config" class="storage-config-panel">
                <h4>本地存储配置</h4>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="local-path">存储路径</label>
                        <input type="text" id="local-path" class="form-input" placeholder="./data">
                        <div class="field-help">文件存储的本地目录路径</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="local-max-size">最大存储大小 (MB)</label>
                        <input type="number" id="local-max-size" class="form-input" placeholder="0">
                        <div class="field-help">0表示无限制</div>
                    </div>
                </div>
            </div>

            <!-- S3存储配置 -->
            <div id="s3-config" class="storage-config-panel" style="display: none;">
                <h4>S3 兼容存储配置</h4>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="s3-endpoint">端点地址 *</label>
                        <input type="text" id="s3-endpoint" class="form-input" placeholder="https://s3.amazonaws.com">
                    </div>
                    
                    <div class="form-group">
                        <label for="s3-region">区域</label>
                        <input type="text" id="s3-region" class="form-input" placeholder="us-east-1">
                    </div>
                    
                    <div class="form-group">
                        <label for="s3-access-key">Access Key *</label>
                        <input type="text" id="s3-access-key" class="form-input" placeholder="">
                    </div>
                    
                    <div class="form-group">
                        <label for="s3-secret-key">Secret Key *</label>
                        <input type="password" id="s3-secret-key" class="form-input" placeholder="">
                    </div>
                    
                    <div class="form-group">
                        <label for="s3-bucket">存储桶名称 *</label>
                        <input type="text" id="s3-bucket" class="form-input" placeholder="my-bucket">
                    </div>
                    
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="s3-path-style" class="checkbox">
                            <label for="s3-path-style">使用路径样式访问</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="s3-ssl" class="checkbox" checked>
                            <label for="s3-ssl">启用 SSL</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- WebDAV存储配置 -->
            <div id="webdav-config" class="storage-config-panel" style="display: none;">
                <h4>WebDAV 存储配置</h4>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="webdav-url">WebDAV URL *</label>
                        <input type="text" id="webdav-url" class="form-input" placeholder="https://your-webdav-server.com/dav">
                    </div>
                    
                    <div class="form-group">
                        <label for="webdav-username">用户名 *</label>
                        <input type="text" id="webdav-username" class="form-input" placeholder="">
                    </div>
                    
                    <div class="form-group">
                        <label for="webdav-password">密码 *</label>
                        <input type="password" id="webdav-password" class="form-input" placeholder="">
                    </div>
                    
                    <div class="form-group">
                        <label for="webdav-path">存储路径</label>
                        <input type="text" id="webdav-path" class="form-input" placeholder="/" value="/">
                    </div>
                    
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="webdav-ssl" class="checkbox" checked>
                            <label for="webdav-ssl">验证 SSL 证书</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- FTP存储配置 -->
            <div id="ftp-config" class="storage-config-panel" style="display: none;">
                <h4>FTP 存储配置</h4>
                <div class="form-grid">
                    <div class="form-group">
                        <label for="ftp-host">FTP 主机 *</label>
                        <input type="text" id="ftp-host" class="form-input" placeholder="ftp.example.com">
                    </div>
                    
                    <div class="form-group">
                        <label for="ftp-port">端口</label>
                        <input type="number" id="ftp-port" class="form-input" placeholder="21" value="21">
                    </div>
                    
                    <div class="form-group">
                        <label for="ftp-username">用户名 *</label>
                        <input type="text" id="ftp-username" class="form-input" placeholder="">
                    </div>
                    
                    <div class="form-group">
                        <label for="ftp-password">密码 *</label>
                        <input type="password" id="ftp-password" class="form-input" placeholder="">
                    </div>
                    
                    <div class="form-group">
                        <label for="ftp-path">存储路径</label>
                        <input type="text" id="ftp-path" class="form-input" placeholder="/" value="/">
                    </div>
                    
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="ftp-passive" class="checkbox" checked>
                            <label for="ftp-passive">被动模式</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <div class="checkbox-group">
                            <input type="checkbox" id="ftp-ssl" class="checkbox">
                            <label for="ftp-ssl">启用 FTPS</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 存储操作 -->
    <div class="operations-section">
        <div class="section-header">
            <h3>存储操作</h3>
        </div>
        
        <div class="operations-grid">
            <div class="operation-card">
                <div class="operation-icon">🧹</div>
                <div class="operation-content">
                    <h4>清理存储</h4>
                    <p>清理过期文件和临时数据</p>
                    <button id="cleanup-storage-btn" class="btn btn-warning">开始清理</button>
                </div>
            </div>
            
            <div class="operation-card">
                <div class="operation-icon">🔄</div>
                <div class="operation-content">
                    <h4>存储迁移</h4>
                    <p>在不同存储后端间迁移文件</p>
                    <button id="migrate-storage-btn" class="btn btn-primary">开始迁移</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 存储分布 -->
    <div class="distribution-section">
        <div class="section-header">
            <h3>存储类型分布</h3>
        </div>
        <div id="storage-distribution" class="distribution-container">
            <!-- 分布数据将由JavaScript动态填充 -->
        </div>
    </div>
</div>

<!-- 清理确认模态框 -->
<div id="cleanup-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>存储清理</h3>
            <button class="modal-close storage-modal-close">&times;</button>
        </div>
        
        <div class="modal-body">
            <div class="form">
                <div class="form-group">
                    <label>清理类型</label>
                    <div class="radio-group">
                        <label class="radio-label">
                            <input type="radio" name="cleanup-type" value="expired" checked>
                            <span>仅清理过期文件</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="cleanup-type" value="temp">
                            <span>清理临时文件</span>
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="cleanup-type" value="all">
                            <span>清理所有可清理文件</span>
                        </label>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="cleanup-days">清理多少天前的文件</label>
                    <input type="number" id="cleanup-days" class="form-input" value="30" min="1">
                </div>
            </div>
        </div>
        
        <div class="modal-footer">
            <button class="btn btn-secondary storage-modal-close">取消</button>
            <button id="confirm-cleanup-btn" class="btn btn-warning">确认清理</button>
        </div>
    </div>
</div>

<!-- 迁移模态框 -->
<div id="migrate-modal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3>存储迁移</h3>
            <button class="modal-close storage-modal-close">&times;</button>
        </div>
        
        <div class="modal-body">
            <div class="form">
                <div class="form-group">
                    <label for="migrate-from">源存储类型</label>
                    <select id="migrate-from" class="form-select">
                        <!-- 选项将由JavaScript动态填充 -->
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="migrate-to">目标存储类型</label>
                    <select id="migrate-to" class="form-select">
                        <!-- 选项将由JavaScript动态填充 -->
                    </select>
                </div>
                
                <div class="warning-content">
                    <div class="warning-icon">⚠️</div>
                    <div class="warning-text">
                        <p><strong>注意：</strong></p>
                        <ul>
                            <li>迁移过程可能需要较长时间</li>
                            <li>建议在低峰期进行迁移</li>
                            <li>迁移期间请勿关闭系统</li>
                            <li>建议先备份重要数据</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="modal-footer">
            <button class="btn btn-secondary storage-modal-close">取消</button>
            <button id="start-migrate-btn" class="btn btn-primary">开始迁移</button>
        </div>
    </div>
</div>

<style>
/* 存储管理特定样式 */
.storage-management {
    padding: 20px;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    display: flex;
    align-items: center;
    gap: 15px;
}

.stat-icon {
    font-size: 24px;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.stat-content {
    flex: 1;
}

.stat-label {
    font-size: 14px;
    color: #6b7280;
    margin-bottom: 4px;
}

.stat-value {
    font-size: 24px;
    font-weight: 600;
    color: #1f2937;
}

.usage-section {
    background: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    margin-bottom: 30px;
}

.usage-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
}

.storage-config-panel {
    background: #f9fafb;
    border-radius: 8px;
    padding: 20px;
    margin-top: 20px;
}

.storage-config-panel h4 {
    margin: 0 0 20px 0;
    color: #1f2937;
}

.operations-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

.operation-card {
    background: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    display: flex;
    align-items: flex-start;
    gap: 15px;
}

.operation-icon {
    font-size: 24px;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.operation-content {
    flex: 1;
}

.operation-content h4 {
    margin: 0 0 8px 0;
    color: #1f2937;
}

.operation-content p {
    margin: 0 0 15px 0;
    color: #6b7280;
    font-size: 14px;
}

.distribution-container {
    background: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.storage-type-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 0;
    border-bottom: 1px solid #e5e7eb;
}

.storage-type-item:last-child {
    border-bottom: none;
}

.storage-type-name {
    font-weight: 500;
    color: #1f2937;
}

.storage-type-stats {
    display: flex;
    gap: 20px;
    color: #6b7280;
    font-size: 14px;
}

.storage-type-percent {
    font-weight: 500;
    color: #1f2937;
}

.radio-group {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.radio-label {
    display: flex;
    align-items: center;
    gap: 8px;
    cursor: pointer;
}

.radio-label input[type="radio"] {
    margin: 0;
}
</style>
